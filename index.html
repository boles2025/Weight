<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق تتبع اللياقة والصحة المتقدم</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
            --water-color: #00a8ff;
        }
        
        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #a8c0ff 0%, #3f2b96 100%);
            color: #333;
            padding-top: 20px;
            min-height: 100vh;
            padding-bottom: 60px; /* مساحة للفوتر */
            overflow-x: hidden;
        }
        
        /* Animations Keyframes */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes wave {
            0% { transform: translateX(0) translateZ(0) scaleY(1) }
            50% { transform: translateX(-25%) translateZ(0) scaleY(0.55) }
            100% { transform: translateX(-50%) translateZ(0) scaleY(1) }
        }

        @keyframes gradient-text {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .animate-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }
        
        /* Delays for animation sequence */
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }

        .app-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header h1 {
            animation: float 3s ease-in-out infinite;
        }
        
        .nav-tabs {
            border-bottom: none;
            background-color: #f8f9fa;
            padding: 10px 15px 0;
            overflow-x: auto;
            flex-wrap: nowrap;
        }
        
        .nav-tabs .nav-link {
            border: none;
            border-radius: 15px 15px 0 0;
            margin: 0 5px;
            color: var(--dark-color);
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            white-space: nowrap;
        }
        
        .nav-tabs .nav-link:hover {
            background-color: rgba(52, 152, 219, 0.1);
            transform: translateY(-3px);
        }
        
        .nav-tabs .nav-link.active {
            background-color: white;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 -5px 10px rgba(0,0,0,0.05);
        }
        
        .tab-content {
            padding: 25px;
            min-height: 500px;
        }
        
        .card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }
        
        .card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background: white;
            border-bottom: 2px solid #f0f0f0;
            font-weight: bold;
            padding: 15px 20px;
            border-radius: 15px 15px 0 0 !important;
            color: var(--primary-color);
        }
        
        /* Water Tracker Styles */
        .water-container {
            text-align: center;
            padding: 20px;
            position: relative;
        }

        .big-water-cup {
            width: 150px;
            height: 200px;
            border: 4px solid #ddd;
            border-top: none;
            border-radius: 0 0 30px 30px;
            margin: 0 auto 20px;
            position: relative;
            overflow: hidden;
            background: #fff;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }

        .water-level {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%; /* Dynamic height */
            background: linear-gradient(to top, #00c6fb 0%, #005bea 100%);
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.8;
        }

        .water-level::before {
            content: "";
            position: absolute;
            top: -10px;
            left: 0;
            width: 200%;
            height: 20px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            animation: wave 2s infinite linear;
        }

        .water-controls button {
            transition: transform 0.2s;
        }
        .water-controls button:active {
            transform: scale(0.9);
        }
        
        /* Buttons Styling */
        .btn {
            border-radius: 12px;
            padding: 10px 20px;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .btn-primary { background: linear-gradient(45deg, #2980b9, #3498db); border: none; }
        .btn-success { background: linear-gradient(45deg, #27ae60, #2ecc71); border: none; }
        .btn-danger { background: linear-gradient(45deg, #c0392b, #e74c3c); border: none; }
        .btn-warning { background: linear-gradient(45deg, #f39c12, #f1c40f); border: none; color: #fff; }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.15);
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f1f2f6 100%);
            border-left: 5px solid var(--primary-color);
        }

        /* Floating Action Button */
        .floating-action {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
        }
        
        .floating-btn {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff00cc, #333399);
            color: white;
            border: none;
            font-size: 28px;
            box-shadow: 0 10px 25px rgba(51, 51, 153, 0.5);
            animation: pulse-glow 2s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .floating-btn:hover {
            transform: rotate(90deg) scale(1.1);
        }

        /* Footer Signature */
        .paul-signature {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(0,0,0,0.85);
            color: white;
            text-align: center;
            padding: 10px 0;
            font-size: 16px;
            z-index: 999;
            backdrop-filter: blur(5px);
            border-top: 2px solid var(--primary-color);
        }

        .paul-name {
            font-weight: 800;
            font-size: 1.2rem;
            background: linear-gradient(270deg, #ff00cc, #333399, #00c6fb, #f1c40f);
            background-size: 800% 800%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-text 5s ease infinite;
            display: inline-block;
            margin: 0 10px;
        }

        .moving-icon {
            display: inline-block;
            animation: float 2s ease-in-out infinite;
            color: var(--warning-color);
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="app-container animate-up">
            <div class="app-header">
                <h1><i class="fas fa-heartbeat me-2"></i>تطبيق اللياقة الذكي</h1>
                <p class="mb-0">تتبع صحتك بأسلوب عصري ومتطور</p>
            </div>
            
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab"><i class="fas fa-home me-1"></i>الرئيسية</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="weight-tab" data-bs-toggle="tab" data-bs-target="#weight" type="button" role="tab"><i class="fas fa-weight me-1"></i>الوزن</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="food-tab" data-bs-toggle="tab" data-bs-target="#food" type="button" role="tab"><i class="fas fa-utensils me-1"></i>الطعام</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="water-tab" data-bs-toggle="tab" data-bs-target="#water" type="button" role="tab"><i class="fas fa-tint me-1"></i>المياه</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button" role="tab"><i class="fas fa-walking me-1"></i>النشاط</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="medication-tab" data-bs-toggle="tab" data-bs-target="#medication" type="button" role="tab"><i class="fas fa-pills me-1"></i>أدوية</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="report-tab" data-bs-toggle="tab" data-bs-target="#report" type="button" role="tab"><i class="fas fa-chart-pie me-1"></i>التقارير</button>
                </li>
            </ul>
            
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="home" role="tabpanel">
                    <div class="motivation-quote animate-up delay-1 text-center p-3 bg-light rounded mb-4" style="border-right: 4px solid var(--primary-color);">
                        <i class="fas fa-quote-left me-2 text-primary"></i>
                        <span id="daily-quote" class="fw-bold">النجاح هو مجموع الجهود الصغيرة المتكررة يومياً</span>
                        <i class="fas fa-quote-right ms-2 text-primary"></i>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="card stat-card animate-up delay-2">
                                <div class="card-body text-center">
                                    <div class="stat-value h2 fw-bold text-primary" id="current-weight">--</div>
                                    <div class="stat-label text-muted">الوزن الحالي (كجم)</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card stat-card animate-up delay-3">
                                <div class="card-body text-center">
                                    <div class="stat-value h2 fw-bold text-success" id="total-calories">0</div>
                                    <div class="stat-label text-muted">السعرات اليوم</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card stat-card animate-up delay-4">
                                <div class="card-body text-center">
                                    <div class="stat-value h2 fw-bold text-info" id="steps-today">0</div>
                                    <div class="stat-label text-muted">خطوات اليوم التقريبية</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card animate-up delay-4">
                        <div class="card-header">
                            <i class="fas fa-chart-line me-2"></i>تقدم خسارة الوزن
                        </div>
                        <div class="card-body">
                            <div class="weight-chart" id="weight-chart" style="height: 200px; display: flex; align-items: flex-end; justify-content: space-around; background: #f9f9f9; border-radius: 10px; padding: 10px;">
                                </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="weight" role="tabpanel">
                    <div class="card animate-up">
                        <div class="card-header"><i class="fas fa-plus-circle me-2"></i>إضافة وزن جديد</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">الوزن (كجم)</label>
                                    <input type="number" class="form-control" id="weight-input" step="0.1">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">التاريخ</label>
                                    <input type="date" class="form-control" id="weight-date">
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" id="add-weight-btn"><i class="fas fa-save me-1"></i>حفظ</button>
                        </div>
                    </div>
                    <div class="card animate-up delay-1">
                        <div class="card-header"><i class="fas fa-history me-2"></i>السجل</div>
                        <div class="card-body p-0" id="weight-history"></div>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="food" role="tabpanel">
                    <div class="card animate-up">
                        <div class="card-header"><i class="fas fa-robot me-2"></i>محلل الطعام الذكي</div>
                        <div class="card-body">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="food-ai-input" placeholder="ماذا أكلت؟ (مثال: بيض مسلوق)">
                                <button class="btn btn-primary" id="ai-food-btn">تحليل</button>
                            </div>
                            <div id="ai-food-response" class="alert alert-light border">نتيجة التحليل ستظهر هنا...</div>
                            <button class="btn btn-success w-100 mt-2" id="add-ai-food-btn" style="display: none;">إضافة لليوم</button>
                        </div>
                    </div>
                    <div class="card animate-up delay-1">
                        <div class="card-header">وجبات اليوم</div>
                        <div class="card-body p-0" id="today-food"></div>
                    </div>
                </div>

                <div class="tab-pane fade" id="water" role="tabpanel">
                    <div class="card animate-up">
                        <div class="card-header bg-info text-white">
                            <i class="fas fa-tint me-2"></i>تتبع شرب المياه
                        </div>
                        <div class="card-body text-center">
                            <h5 class="mb-4">هدفك اليومي: <span id="water-goal-display">3000</span> مل</h5>
                            
                            <div class="water-container">
                                <div class="big-water-cup">
                                    <div class="water-level" id="cup-fill"></div>
                                    <div style="position: absolute; width: 100%; top: 50%; transform: translateY(-50%); z-index: 2; font-weight: bold; color: #333; text-shadow: 0 0 5px white;">
                                        <span id="current-water-amount">0</span> مل
                                    </div>
                                </div>
                            </div>

                            <div class="water-controls mt-4 d-flex justify-content-center gap-2 flex-wrap">
                                <button class="btn btn-outline-primary rounded-pill" onclick="addWater(250)">
                                    <i class="fas fa-glass-whiskey me-1"></i> كوب (250مل)
                                </button>
                                <button class="btn btn-outline-info rounded-pill" onclick="addWater(500)">
                                    <i class="fas fa-wine-bottle me-1"></i> زجاجة (500مل)
                                </button>
                                <button class="btn btn-outline-warning rounded-pill" onclick="resetDailyWater()">
                                    <i class="fas fa-undo me-1"></i> تصفير اليوم
                                </button>
                            </div>
                            
                            <div class="progress mt-4" style="height: 25px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" id="water-progress-bar" role="progressbar" style="width: 0%">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="activity" role="tabpanel">
                    <div class="card animate-up">
                        <div class="card-header"><i class="fas fa-walking me-2"></i>تسجيل نشاط</div>
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-6"><select class="form-select" id="activity-type"><option value="مشي">مشي</option><option value="جري">جري</option><option value="تمرين">تمرين</option></select></div>
                                <div class="col-6"><input type="number" class="form-control" id="activity-duration" placeholder="المدة (ساعات)"></div>
                                <div class="col-12"><input type="date" class="form-control" id="activity-date"></div>
                            </div>
                            <button class="btn btn-primary w-100 mt-3" id="add-activity-btn">حفظ النشاط</button>
                        </div>
                    </div>
                    <div class="card animate-up delay-1">
                        <div class="card-body p-0" id="activity-history"></div>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="medication" role="tabpanel">
                    <div class="card animate-up">
                        <div class="card-header">إضافة دواء</div>
                        <div class="card-body">
                            <input type="text" class="form-control mb-2" id="med-name" placeholder="اسم الدواء">
                            <input type="text" class="form-control mb-2" id="med-dosage" placeholder="الجرعة">
                            <input type="time" class="form-control mb-2" id="med-time">
                            <button class="btn btn-primary w-100" id="add-medication-btn">إضافة</button>
                        </div>
                    </div>
                    <div class="card animate-up delay-1">
                        <div class="card-body p-0" id="medication-list"></div>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="report" role="tabpanel">
                    <div class="daily-report-card animate-up" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px; padding: 20px;">
                        <div class="row text-center">
                            <div class="col-3">
                                <h3 id="report-calories">0</h3>
                                <small>سعرات</small>
                            </div>
                            <div class="col-3">
                                <h3 id="report-steps">0</h3>
                                <small>خطوات</small>
                            </div>
                            <div class="col-3">
                                <h3 id="report-water-cups">0</h3>
                                <small>ماء (مل)</small>
                            </div>
                            <div class="col-3">
                                <h3 id="report-activity">0</h3>
                                <small>نشاط (د)</small>
                            </div>
                        </div>
                    </div>
                    <div id="achievements-list" class="mt-3 animate-up delay-2"></div>
                    <button class="btn btn-warning w-100 mt-3" id="share-report-btn">مشاركة التقرير</button>
                </div>
            </div>
            
            <div class="p-4 border-top bg-light d-flex flex-wrap gap-2 justify-content-center">
                <button class="btn btn-success flex-grow-1" id="export-data-btn"><i class="fas fa-download me-1"></i> تصدير</button>
                <button class="btn btn-primary flex-grow-1" id="import-data-btn"><i class="fas fa-upload me-1"></i> استيراد</button>
                <button class="btn btn-danger flex-grow-1" onclick="clearAllData()"><i class="fas fa-trash-alt me-1"></i> حذف البيانات (تصفير)</button>
                <input type="file" id="import-file" style="display: none;" accept=".json">
            </div>
        </div>
    </div>

    <div class="floating-action">
        <button class="floating-btn" data-bs-toggle="modal" data-bs-target="#quickAddModal">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <div class="modal fade" id="quickAddModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 20px;">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">إضافة سريعة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="d-grid gap-3">
                        <button class="btn btn-primary py-3" data-bs-dismiss="modal" onclick="switchToTab('weight')"><i class="fas fa-weight me-2"></i>وزن</button>
                        <button class="btn btn-success py-3" data-bs-dismiss="modal" onclick="switchToTab('food')"><i class="fas fa-utensils me-2"></i>طعام</button>
                        <button class="btn btn-info py-3 text-white" data-bs-dismiss="modal" onclick="switchToTab('water')"><i class="fas fa-tint me-2"></i>مياه</button>
                        <button class="btn btn-warning py-3 text-white" data-bs-dismiss="modal" onclick="switchToTab('activity')"><i class="fas fa-walking me-2"></i>نشاط</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="paul-signature">
        <div class="container">
            <i class="fas fa-code moving-icon"></i>
            تصميم وتطوير
            <span class="paul-name">مهندس / بولس سمير</span>
            <i class="fas fa-laptop-code moving-icon"></i>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // === بيانات التطبيق ===
        let appData = {
            weightHistory: [],
            foodHistory: [],
            activityHistory: [],
            medications: [],
            waterIntake: [], // {date: 'YYYY-MM-DD', amount: ml}
            settings: { calorieGoal: 1800, stepGoal: 10000, waterGoal: 3000 }
        };

        const foodDatabase = [
            { name: "تفاحة", calories: 52 }, { name: "موز", calories: 89 }, 
            { name: "خبز", calories: 265 }, { name: "أرز", calories: 130 },
            { name: "دجاج", calories: 165 }, { name: "بيض", calories: 155 }
        ];

        // === تهيئة التطبيق ===
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            initializeApp();
            
            // تعيين التاريخ الحالي
            const today = new Date().toISOString().split('T')[0];
            if(document.getElementById('weight-date')) document.getElementById('weight-date').value = today;
            if(document.getElementById('activity-date')) document.getElementById('activity-date').value = today;
        });

        function initializeApp() {
            updateWeightChart();
            updateWeightHistory();
            updateTodayFood();
            updateMedicationList();
            updateActivityHistory();
            updateStats();
            updateWaterUI(); // تحديث واجهة المياه
            updateDailyReport();
        }

        // === وظائف تتبع المياه (جديد) ===
        function addWater(amount) {
            const today = new Date().toISOString().split('T')[0];
            let todayEntry = appData.waterIntake.find(w => w.date === today);
            
            if (!todayEntry) {
                todayEntry = { date: today, amount: 0 };
                appData.waterIntake.push(todayEntry);
            }
            
            todayEntry.amount += amount;
            saveData();
            updateWaterUI();
            updateDailyReport();
            
            // تأثير صوتي بسيط (اختياري)
            // new Audio('water-drop.mp3').play().catch(e => {}); 
        }

        function resetDailyWater() {
            const today = new Date().toISOString().split('T')[0];
            const index = appData.waterIntake.findIndex(w => w.date === today);
            if (index !== -1) {
                appData.waterIntake[index].amount = 0;
                saveData();
                updateWaterUI();
                updateDailyReport();
            }
        }

        function updateWaterUI() {
            const today = new Date().toISOString().split('T')[0];
            const entry = appData.waterIntake.find(w => w.date === today);
            const currentAmount = entry ? entry.amount : 0;
            const goal = appData.settings.waterGoal;
            
            // تحديث النص
            document.getElementById('current-water-amount').textContent = currentAmount;
            
            // تحديث الكوب الكبير
            const percentage = Math.min((currentAmount / goal) * 100, 100);
            document.getElementById('cup-fill').style.height = `${percentage}%`;
            
            // تحديث شريط التقدم
            const progressBar = document.getElementById('water-progress-bar');
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${Math.round(percentage)}%`;
            
            if(percentage >= 100) {
                progressBar.classList.remove('bg-info');
                progressBar.classList.add('bg-success');
                progressBar.textContent = "ممتاز! اكتمل الهدف";
            } else {
                progressBar.classList.remove('bg-success');
                progressBar.classList.add('bg-info');
            }
        }

        // === وظيفة تصفير البيانات (جديد) ===
        function clearAllData() {
            if (confirm("تحذير هام!\nهل أنت متأكد تماماً من رغبتك في حذف جميع البيانات وتصفير التطبيق؟\nلا يمكن التراجع عن هذا الإجراء.")) {
                localStorage.removeItem('fitnessTrackerData');
                appData = {
                    weightHistory: [],
                    foodHistory: [],
                    activityHistory: [],
                    medications: [],
                    waterIntake: [],
                    settings: { calorieGoal: 1800, stepGoal: 10000, waterGoal: 3000 }
                };
                
                // تأثير حركي قبل إعادة التحميل
                document.querySelector('.app-container').style.transform = 'scale(0.8) rotate(5deg)';
                document.querySelector('.app-container').style.opacity = '0';
                
                setTimeout(() => {
                    location.reload();
                }, 500);
            }
        }

        // === الوظائف الأساسية الموجودة سابقاً (محدثة) ===
        
        // --- الوزن ---
        document.getElementById('add-weight-btn').addEventListener('click', function() {
            const w = parseFloat(document.getElementById('weight-input').value);
            const d = document.getElementById('weight-date').value;
            if (w && d) {
                appData.weightHistory.push({ weight: w, date: d });
                appData.weightHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
                saveData();
                initializeApp();
                alert('تم حفظ الوزن');
                document.getElementById('weight-input').value = '';
            }
        });

        function updateWeightChart() {
            const chart = document.getElementById('weight-chart');
            chart.innerHTML = '';
            const data = appData.weightHistory.slice(0, 7).reverse(); // آخر 7 قياسات
            if (data.length === 0) { chart.innerHTML = '<p class="text-center w-100">لا توجد بيانات</p>'; return; }
            
            const maxW = Math.max(...data.map(i => i.weight)) + 5;
            data.forEach(item => {
                const barHeight = (item.weight / maxW) * 100;
                const bar = document.createElement('div');
                bar.style.height = `${barHeight}%`;
                bar.style.width = '20px';
                bar.style.background = 'linear-gradient(to top, #3498db, #2ecc71)';
                bar.style.borderRadius = '5px 5px 0 0';
                bar.style.position = 'relative';
                bar.title = `${item.weight}kg - ${item.date}`;
                
                // Label
                const lbl = document.createElement('div');
                lbl.innerText = item.weight;
                lbl.style.fontSize = '10px';
                lbl.style.position = 'absolute';
                lbl.style.top = '-20px';
                lbl.style.width = '100%';
                lbl.style.textAlign = 'center';
                
                bar.appendChild(lbl);
                chart.appendChild(bar);
            });
            
            // تحديث البطاقة الرئيسية
            if(appData.weightHistory.length > 0) {
                document.getElementById('current-weight').textContent = appData.weightHistory[0].weight;
            }
        }

        function updateWeightHistory() {
            const container = document.getElementById('weight-history');
            container.innerHTML = '';
            appData.weightHistory.forEach((item, idx) => {
                container.innerHTML += `
                    <div class="d-flex justify-content-between p-3 border-bottom ${idx % 2 === 0 ? 'bg-light' : ''}">
                        <span>${item.date}</span>
                        <span class="fw-bold">${item.weight} كجم</span>
                    </div>
                `;
            });
        }

        // --- الطعام ---
        document.getElementById('ai-food-btn').addEventListener('click', function() {
            const input = document.getElementById('food-ai-input').value;
            const btn = document.getElementById('add-ai-food-btn');
            const res = document.getElementById('ai-food-response');
            
            res.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحليل...';
            
            setTimeout(() => {
                const found = foodDatabase.find(f => input.includes(f.name));
                let resultFood = found || { name: input, calories: Math.floor(Math.random() * 300) + 50, isEst: true };
                
                res.innerHTML = `<strong>${resultFood.name}</strong>: ${resultFood.calories} سعرة حرارية`;
                res.className = 'alert alert-success border';
                btn.style.display = 'block';
                btn.onclick = function() {
                    const today = new Date().toISOString().split('T')[0];
                    appData.foodHistory.push({ food: resultFood, date: today, time: new Date().toLocaleTimeString() });
                    saveData();
                    updateTodayFood();
                    updateStats();
                    updateDailyReport();
                    btn.style.display = 'none';
                    document.getElementById('food-ai-input').value = '';
                    res.innerHTML = 'تمت الإضافة بنجاح!';
                };
            }, 1000);
        });

        function updateTodayFood() {
            const today = new Date().toISOString().split('T')[0];
            const list = appData.foodHistory.filter(f => f.date === today);
            const container = document.getElementById('today-food');
            container.innerHTML = '';
            let total = 0;
            list.forEach(item => {
                total += item.food.calories;
                container.innerHTML += `
                    <div class="d-flex justify-content-between p-3 border-bottom">
                        <span>${item.food.name}</span>
                        <span class="badge bg-primary rounded-pill">${item.food.calories} سعرة</span>
                    </div>
                `;
            });
            document.getElementById('total-calories').textContent = total;
        }

        // --- النشاط ---
        document.getElementById('add-activity-btn').addEventListener('click', function() {
            const type = document.getElementById('activity-type').value;
            const dur = parseFloat(document.getElementById('activity-duration').value);
            const date = document.getElementById('activity-date').value;
            
            if(dur && date) {
                // حساب تقريبي للسعرات (ساعة مشي = 250)
                let cals = dur * 250; 
                if(type === 'جري') cals = dur * 400;
                
                appData.activityHistory.push({ type, duration: dur, date, cals: Math.round(cals) });
                saveData();
                updateActivityHistory();
                updateStats();
                updateDailyReport();
                alert('تم حفظ النشاط');
            }
        });

        function updateActivityHistory() {
            const container = document.getElementById('activity-history');
            container.innerHTML = '';
            appData.activityHistory.reverse().forEach(a => {
                container.innerHTML += `
                    <div class="d-flex justify-content-between p-3 border-bottom">
                        <div><strong>${a.type}</strong> <small class="text-muted">(${a.duration} س)</small></div>
                        <span class="text-success">-${a.cals} سعرة</span>
                    </div>
                `;
            });
        }

        // --- الأدوية ---
        document.getElementById('add-medication-btn').addEventListener('click', function() {
            const name = document.getElementById('med-name').value;
            const dose = document.getElementById('med-dosage').value;
            const time = document.getElementById('med-time').value;
            if(name) {
                appData.medications.push({ name, dose, time, taken: false, id: Date.now() });
                saveData();
                updateMedicationList();
                document.getElementById('med-name').value = '';
            }
        });

        function updateMedicationList() {
            const container = document.getElementById('medication-list');
            container.innerHTML = '';
            appData.medications.forEach(m => {
                container.innerHTML += `
                    <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                        <div>
                            <div class="fw-bold">${m.name}</div>
                            <small>${m.dose} @ ${m.time}</small>
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="deleteMed(${m.id})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            });
        }
        
        function deleteMed(id) {
            appData.medications = appData.medications.filter(m => m.id !== id);
            saveData();
            updateMedicationList();
        }

        // --- الإحصائيات والتقارير ---
        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            
            // الخطوات (تقدير من النشاط)
            const todayActs = appData.activityHistory.filter(a => a.date === today);
            const steps = todayActs.reduce((acc, curr) => acc + (curr.duration * 6000), 0); // تقدير 6000 خطوة بالساعة
            document.getElementById('steps-today').textContent = Math.round(steps);
        }

        function updateDailyReport() {
            const today = new Date().toISOString().split('T')[0];
            
            const cals = document.getElementById('total-calories').textContent;
            const steps = document.getElementById('steps-today').textContent;
            
            // المياه من البيانات الحقيقية
            const waterEntry = appData.waterIntake.find(w => w.date === today);
            const water = waterEntry ? waterEntry.amount : 0;

            const acts = appData.activityHistory.filter(a => a.date === today);
            const actMins = acts.reduce((acc, c) => acc + (c.duration * 60), 0);

            document.getElementById('report-calories').textContent = cals;
            document.getElementById('report-steps').textContent = steps;
            document.getElementById('report-water-cups').textContent = water;
            document.getElementById('report-activity').textContent = Math.round(actMins);
            
            // الإنجازات
            const achList = document.getElementById('achievements-list');
            achList.innerHTML = '';
            if(water >= appData.settings.waterGoal) achList.innerHTML += '<div class="alert alert-info"><i class="fas fa-check-circle"></i> حققت هدف شرب الماء!</div>';
            if(cals > 0 && cals < appData.settings.calorieGoal) achList.innerHTML += '<div class="alert alert-success"><i class="fas fa-check-circle"></i> ملتزم بالسعرات الحرارية</div>';
            if(steps > 5000) achList.innerHTML += '<div class="alert alert-warning"><i class="fas fa-fire"></i> نشاط بدني ممتاز</div>';
        }

        // --- مشاركة ---
        document.getElementById('share-report-btn').addEventListener('click', function() {
             const txt = `تقريري اليومي:\nسعرات: ${document.getElementById('report-calories').textContent}\nمياه: ${document.getElementById('report-water-cups').textContent} مل`;
             if(navigator.share) navigator.share({ title: 'تقرير صحتي', text: txt });
             else alert(txt);
        });

        // --- تخزين البيانات ---
        function saveData() { localStorage.setItem('fitnessTrackerData', JSON.stringify(appData)); }
        function loadData() {
            const d = localStorage.getItem('fitnessTrackerData');
            if(d) appData = JSON.parse(d);
            // التأكد من وجود مصفوفة المياه إذا كانت البيانات قديمة
            if(!appData.waterIntake) appData.waterIntake = [];
        }
        
        // --- تصدير واستيراد ---
        document.getElementById('export-data-btn').addEventListener('click', function() {
            const dataStr = JSON.stringify(appData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', 'health-data.json');
            link.click();
        });

        document.getElementById('import-data-btn').addEventListener('click', () => document.getElementById('import-file').click());
        document.getElementById('import-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    appData = JSON.parse(event.target.result);
                    saveData();
                    location.reload();
                } catch(err) { alert('فشل استيراد الملف'); }
            };
            reader.readAsText(file);
        });

        function switchToTab(tabId) {
            const triggerEl = document.querySelector(`#${tabId}-tab`);
            const tab = new bootstrap.Tab(triggerEl);
            tab.show();
        }
    </script>
</body>
</html>